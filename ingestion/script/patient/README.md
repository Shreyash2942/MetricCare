# 🧬 MetricCare – FHIR Patient Data Generator (CMS-Focused)

This module generates **FHIR-style Patient resources** using the `fhir.resources` library and `Faker`.  
It creates **synthetic, HIPAA-safe JSON files** optimized for **CMS metric computation** and ingestion into your **AWS Data Lakehouse** (S3 → Glue → Hudi → Athena).

---

## 📌 Overview

The generator produces **FHIR-like Patient JSON objects** with randomized:
- Demographics (`gender`, `birthDate`)
- Geographic information (`address.city`, `address.state`)
- Language preferences (`communication.language.text`)
- Managing organization (hospital reference)
- Death status (`deceasedDateTime`)

Each record is lightweight, schema-consistent, and directly usable for **CMS compliance metrics**:
- Mortality Rate  
- Readmission Rate  
- Hospital-Acquired Infection (HAI)  
- Average Length of Stay (ALOS)  
- Demographic / Regional Insights  

---

## ⚙️ Features

| Feature | Description |
|----------|--------------|
| ✅ **CMS-optimized schema** | Only includes attributes required for CMS metric computation |
| 🧑‍⚕️ **FHIR-compliant format** | Valid FHIR `Patient` resource structure |
| 🌎 **Randomized language & organization** | Enables demographic and regional segmentation |
| 🧾 **Full UUID identifiers** | Globally unique IDs for joining with Encounter & Condition |
| ☁️ **S3-ready output** | JSON naming convention aligns with Bronze-layer ingestion |
| ⚡ **Lightweight JSON (<1 KB)** | Ideal for Glue and Athena performance |

---

## 📁 Folder Structure

```
ingestion/
    └── patient/
         ├── fhir_patient_generator.py   # CMS-focused patient generator script
         ├── README.md                   # This documentation file
         └── sample_output/
```

---

## 🧰 Dependencies

Install required libraries:

```bash
pip install fhir.resources faker
```

Optional for formatting:
```bash
pip install pprintpp
```

---

## 🚀 Usage

Run the generator locally:

```bash
python fhir_patient_generator.py
```

It will print a random FHIR Patient JSON and a suggested S3 path for ingestion.

---

## 🧾 Example Generated Patient Record

Below is a **real example** of a CMS-optimized FHIR-style Patient JSON generated by this script.  
Comments (`# ...`) explain each field’s purpose.

```python
{
  "resourceType": "Patient",  # Defines FHIR resource type
  "id": "d4058000-1077-4de6-94ae-a29518310063",  # Unique patient UUID

  "active": true,  # Indicates record is active

  "meta": {
    "versionId": "1",  # Resource version
    "lastUpdated": "2025-10-13T02:22:22.245910Z"  # Timestamp for audit tracking
  },

  "identifier": [
    {
      "use": "usual",  # Standard identifier
      "type": {"text": "Medical Record Number"},  # Identifier type
      "system": "MetricCare-MRN",  # Internal namespace
      "value": "MC-479336"  # Unique MRN for joining
    }
  ],

  "gender": "male",  # Demographic: gender
  "birthDate": "1985-11-25",  # Demographic: age reference

  "address": [
    {
      "city": "Rossfort",  # Patient's city
      "state": "MP",       # State for regional grouping
      "country": "USA"     # Country (for completeness)
    }
  ],

  "communication": [
    {
      "language": {"text": "Arabic"},  # Preferred language
      "preferred": true
    }
  ],

  "managingOrganization": {
    "reference": "Organization/org-mountainview",  # Organization reference
    "display": "MountainView Healthcare"           # Hospital name
  },

  "deceasedDateTime": "2006-11-20T00:00:00Z"  # Mortality marker (used in CMS mortality rate)
}
```

💾 **Suggested S3 Path:**
```
s3://metriccare-dev/bronze/patient/patient_d4058000-1077-4de6-94ae-a29518310063.json
```

---

## 🧩 Output Fields

| Field | Description | CMS Usage |
|--------|-------------|-----------|
| `id` | Unique patient identifier | Join key with Encounter / Condition |
| `gender` | Patient’s gender | Demographic segmentation |
| `birthDate` | Date of birth | Age grouping for risk adjustment |
| `address.city`, `address.state`, `address.country` | Geographic data | Regional CMS reporting |
| `communication.language.text` | Preferred language | Language-based outcome trends |
| `managingOrganization.display` | Hospital name | Facility-level metrics |
| `deceasedDateTime` | Death timestamp | Mortality rate numerator |
| `meta.lastUpdated` | Timestamp | Data freshness audit |

---

## ☁️ Integration with AWS Lakehouse

Generated JSON files are stored in the **S3 Bronze layer**:

```
s3://<bucket>/bronze/patient/<filename>.json
```

Then processed via:
1. **Bronze Layer (Ingestion)** – Raw JSON → Hudi table  
2. **Silver Layer (Transformation)** – Flatten, clean, normalize  
3. **Gold Layer (Metrics)** – Aggregate CMS metrics (mortality, readmission, HAI, ALOS)

---

## 🧠 Example Analytics Use

Once loaded into Athena or Power BI, you can derive:
- **Mortality by region:** `deceasedDateTime` + `address.state`
- **Readmission trends:** Linked via `id` in Encounter data
- **Infection control:** Linked with Condition codes
- **Demographic performance:** Gender, language, and organization-based outcomes

---

## 📜 License

This script is part of the **MetricCare Data Lakehouse** project.  
It generates **synthetic FHIR resources only** — no real patient information is used.

---

## 👤 Author
**Shreyas Patel**  
_Data Engineer | AWS | PySpark | Terraform | Healthcare Analytics_
